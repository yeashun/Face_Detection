# Face_Detection

人脸检测识别 / Face Detection

## 设计目的

1. 了解并掌握人脸识别的基本原理与实现流程。
2. 学习 OpenCV 中人脸检测与识别相关的常用方法。
3. 设计一个基于 OpenCV + Qt 的可视化系统，实现从人脸采集、预处理、训练到识别的完整流程。
4. 通过实践提升图像处理、模式识别以及软件界面设计的综合能力。

## 设计原理

### 2.1 人脸检测原理

- **原理概述**：使用 Haar-like 矩形特征在不同窗口位置计算灰度加权差，通过 Adaboost 训练弱分类器并级联成强分类器，逐层筛选候选区域以快速定位人脸。
- **优点**：实现简单、实时、计算消耗小，适合做快速检测与教学演示。
- **缺点**：对大角度旋转和极端光照较敏感。

### 2.2 图像预处理

目标是提升特征提取稳定性、减少光照与尺寸差异带来的影响，步骤包括：

1. **灰度化**：将彩色图像转换为灰度，减少通道维度，保留纹理信息。
2. **人脸检测**：在整张图像中检测人脸位置 (x, y, w, h)。
3. **裁剪人脸区域**：只保留检测到的人脸区域以去除背景干扰。
4. **尺寸归一化**：统一人脸图像尺寸（如 200×200），保证特征一致性。
5. **直方图均衡化**：增强对比度，减轻光照不均的影响（使用 `cv2.equalizeHist`）。

### 2.3 人脸识别——LBPH（Local Binary Patterns Histograms）

- **原理**：对每个像素按邻域（radius, neighbors）比较灰度，生成二值编码（LBP），将图像分成若干小块，统计每块 LBP 的直方图并拼接，得到全局特征向量；使用距离度量（欧氏或 Chi-square）比较特征相似度完成分类。
- **优点**：计算量小、对光照和部分表情变化鲁棒、训练快，适合实时小规模应用。
- **参数**：常用 radius=1, neighbors=8，也可尝试更大半径或更多采样点以提高描述能力。
- **置信度（confidence）**：LBPH 的置信度越小越相似，常用阈值范围 ~0–100，根据实际数据调整（例如 50 左右）。

## 系统总体架构

- **数据管理（DataManager）**：管理用户元数据、目录结构、统计信息、导入导出。
- **采集模块（capture.py）**：调用摄像头按用户名采集多张原始人脸图像并保存到 `data/raw/{user}`。
- **预处理模块（preprocess.py / GUI 演示）**：图像灰度化、检测、裁剪、归一化、均衡化并保存到 `data/processed/{user}`。
- **训练模块（train.py）**：读取处理后的数据训练 LBPH 模型并保存 `lbph_model.yml`、`labels.pkl`。
- **识别模块（recognize.py 或 FaceRecognizer 类）**：实时识别（摄像头）与静态图片识别（上传），返回带框的图像与识别结果。
- **GUI（main.py / FaceApp）**：基于 PyQt，包含用户管理、训练、实时识别、图片识别和预处理演示 Tab。

## 程序设计与实现

### 4.1 DataManager

负责目录与 `metadata.json` 管理、统计更新、添加/删除用户等

### 4.2 安全读取图片函数

### 4.3 预处理

### 4.4 训练模块

### 4.5 识别模块

### 4.6 GUI

## 实验结果与展示

### 6.1 预处理展示

### 6.2 实时识别截图

### 6.3 静态图片识别

## 结果分析与讨论

### 7.1 观察到的优点

- 系统端到端流程完整：从采集到识别均可在 GUI 中完成。
- LBPH 在多数日常光照下表现稳定，识别速度快、延迟低，适合现场演示。
- 预处理（均衡化、归一化）对识别稳定性提升明显，能够降低误识别率。

### 7.2 局限与问题

- **光照敏感性**：极端暗/强背光场景检测或识别会失败。
- **姿态与遮挡**：大角度偏转、侧脸或部分遮挡（口罩、眼镜反光）会降低识别率。
- **数据量依赖**：单个用户样本太少会影响泛化能力，建议每用户至少 50 张不同表情/角度样本。
- **安全与鲁棒**：当前系统无活体检测，存在被照片欺骗的风险。

### 7.3 参数和策略建议

- **阈值（threshold）** 应基于验证集调参（例如在验证集上选择使得误识率与漏识率平衡的阈值）。
- **采集时注意多样性**（光照、表情、背景），提高训练集代表性。
- 若需更高精度，考虑用预训练的人脸检测 / 对齐 + 深度 embedding（FaceNet/ArcFace）替换 LBPH。
